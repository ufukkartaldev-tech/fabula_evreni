(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,26633,t=>{"use strict";t.i(36180);var e=t.i(98925),r=t.i(53699);let o=(0,e.collection)(r.db,"stories"),c=(0,e.collection)(r.db,"comments");async function a(){console.warn("⚠️ getStories() is deprecated. Use getStoriesPaginated() for better performance.");try{let t=(0,e.query)(o,(0,e.orderBy)("createdAt","desc"));return(await (0,e.getDocs)(t)).docs.map(t=>{let e=t.data();return{id:t.id,...e,createdAt:e.createdAt?.toDate()||new Date}})}catch(t){return console.error("Error fetching stories:",t),[]}}async function n(t){try{let o=(0,e.doc)(r.db,"stories",t),c=await (0,e.getDoc)(o);if(!c.exists())return null;let a=c.data();return{id:c.id,...a,createdAt:a.createdAt?.toDate()||new Date}}catch(t){return console.error("Error fetching story:",t),null}}async function s(t){try{let r=(0,e.query)(c,(0,e.where)("storyId","==",t),(0,e.orderBy)("createdAt","desc")),o=(await (0,e.getDocs)(r)).docs.map(t=>{let e=t.data();return{id:t.id,...e,createdAt:e.createdAt?.toDate()||new Date}});return d(o)}catch(t){return console.error("Error fetching comments:",t),[]}}function d(t){let e=new Map,r=[];return t.forEach(t=>{e.set(t.id,{...t,replies:[]})}),t.forEach(t=>{let o=e.get(t.id);o&&r.push(o)}),r}async function i(t){try{return(await (0,e.addDoc)(c,{...t,createdAt:e.Timestamp.now()})).id}catch(t){throw console.error("Error adding comment:",t),t}}async function l(t){try{return(await (0,e.addDoc)(o,{...t,createdAt:e.Timestamp.now()})).id}catch(t){throw console.error("Error adding story:",t),t}}async function u(t){try{let o=(0,e.doc)(r.db,"stories",t);await (0,e.runTransaction)(r.db,async t=>{if(!(await t.get(o)).exists())throw Error("Story does not exist!");t.update(o,{"stats.views":(0,e.increment)(1)})})}catch(t){console.error("Error incrementing story views:",t)}}async function y(t,o){try{let c=(0,e.doc)(r.db,"stories",t);await (0,e.updateDoc)(c,{...o,updatedAt:e.Timestamp.now()})}catch(t){throw console.error("Error updating story:",t),t}}async function m(t){try{let o=(0,e.doc)(r.db,"stories",t);await (0,e.deleteDoc)(o)}catch(t){throw console.error("Error deleting story:",t),t}}function w(t,r){let c=r?(0,e.query)(o,(0,e.orderBy)("createdAt","desc"),(0,e.limit)(r)):(0,e.query)(o,(0,e.orderBy)("createdAt","desc"));return(0,e.onSnapshot)(c,e=>{t(e.docs.map(t=>{let e=t.data();return{id:t.id,...e,createdAt:e.createdAt?.toDate()||new Date}}))},t=>{console.error("Error in stories subscription:",t)})}function h(t,o){let c=(0,e.doc)(r.db,"stories",t);return(0,e.onSnapshot)(c,t=>{if(t.exists()){let e=t.data();o({id:t.id,...e,createdAt:e.createdAt?.toDate()||new Date})}else o(null)},t=>{console.error("Error in story subscription:",t)})}function p(t,r){let o=(0,e.query)(c,(0,e.where)("storyId","==",t),(0,e.orderBy)("createdAt","desc"));return(0,e.onSnapshot)(o,t=>{r(d(t.docs.map(t=>{let e=t.data();return{id:t.id,...e,createdAt:e.createdAt?.toDate()||new Date}})))},t=>{console.error("Error in comments subscription:",t)})}async function f(t=12,r){try{let c=(0,e.query)(o,(0,e.orderBy)("createdAt","desc"),(0,e.limit)(t));r&&(c=(0,e.query)(o,(0,e.orderBy)("createdAt","desc"),(0,e.startAfter)(r),(0,e.limit)(t)));let a=await (0,e.getDocs)(c),n=a.docs.map(t=>{let e=t.data();return{id:t.id,...e,createdAt:e.createdAt?.toDate()||new Date}}).filter(t=>"DELETED"!==t.status),s=a.docs[a.docs.length-1]||null;return{stories:n,lastDoc:s}}catch(t){return console.error("Error fetching paginated stories:",t),{stories:[],lastDoc:null}}}t.s(["addComment",()=>i,"addStory",()=>l,"deleteStory",()=>m,"getCommentsByStoryId",()=>s,"getStories",()=>a,"getStoriesPaginated",()=>f,"getStoryById",()=>n,"incrementStoryViews",()=>u,"subscribeToComments",()=>p,"subscribeToStories",()=>w,"subscribeToStory",()=>h,"updateStory",()=>y])}]);