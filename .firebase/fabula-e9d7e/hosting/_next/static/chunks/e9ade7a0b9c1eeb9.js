(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78333,(e,t,a)=>{var r=0/0,s=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,o=/^0o[0-7]+$/i,c=parseInt,l=e.g&&e.g.Object===Object&&e.g,d="object"==typeof self&&self&&self.Object===Object&&self,u=l||d||Function("return this")(),f=Object.prototype.toString,v=Math.max,h=Math.min,m=function(){return u.Date.now()};function y(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function p(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||t&&"object"==typeof t&&"[object Symbol]"==f.call(t))return r;if(y(e)){var t,a="function"==typeof e.valueOf?e.valueOf():e;e=y(a)?a+"":a}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var l=n.test(e);return l||o.test(e)?c(e.slice(2),l?2:8):i.test(e)?r:+e}t.exports=function(e,t,a){var r,s,i,n,o,c,l=0,d=!1,u=!1,f=!0;if("function"!=typeof e)throw TypeError("Expected a function");function g(t){var a=r,i=s;return r=s=void 0,l=t,n=e.apply(i,a)}function j(e){var a=e-c,r=e-l;return void 0===c||a>=t||a<0||u&&r>=i}function x(){var e,a,r,s=m();if(j(s))return b(s);o=setTimeout(x,(e=s-c,a=s-l,r=t-e,u?h(r,i-a):r))}function b(e){return(o=void 0,f&&r)?g(e):(r=s=void 0,n)}function S(){var e,a=m(),i=j(a);if(r=arguments,s=this,c=a,i){if(void 0===o)return l=e=c,o=setTimeout(x,t),d?g(e):n;if(u)return o=setTimeout(x,t),g(c)}return void 0===o&&(o=setTimeout(x,t)),n}return t=p(t)||0,y(a)&&(d=!!a.leading,i=(u="maxWait"in a)?v(p(a.maxWait)||0,t):i,f="trailing"in a?!!a.trailing:f),S.cancel=function(){void 0!==o&&clearTimeout(o),l=0,r=c=s=o=void 0},S.flush=function(){return void 0===o?n:b(m())},S}},27116,e=>{"use strict";e.i(36180);var t=e.i(98925),a=e.i(53699),r=e.i(78333);let s=(0,t.collection)(a.db,"drafts");async function i(e){try{let a={...e,lastSaved:(0,t.serverTimestamp)(),createdAt:(0,t.serverTimestamp)()},r=await (0,t.addDoc)(s,a);return{success:!0,draftId:r.id}}catch(e){return console.error("Error saving draft:",e),{success:!1,error:"Taslak kaydedilemedi"}}}async function n(e,r){try{let s=(0,t.doc)(a.db,"drafts",e);return await (0,t.updateDoc)(s,{...r,lastSaved:(0,t.serverTimestamp)()}),{success:!0}}catch(e){return console.error("Error updating draft:",e),{success:!1,error:"Taslak güncellenemedi"}}}let o=(0,r.default)(async(e,t)=>await n(e,t),2e3);async function c(e){try{let a=(0,t.query)(s,(0,t.where)("userId","==",e),(0,t.orderBy)("lastSaved","desc"));return(await (0,t.getDocs)(a)).docs.map(e=>{let t=e.data();return{id:e.id,...t,createdAt:t.createdAt?.toDate()||new Date,lastSaved:t.lastSaved?.toDate()||new Date}})}catch(e){return console.error("Error fetching drafts:",e),[]}}async function l(e){try{let r=(0,t.doc)(a.db,"drafts",e),s=await (0,t.getDoc)(r);if(!s.exists())return null;let i=s.data();return{id:s.id,...i,createdAt:i.createdAt?.toDate()||new Date,lastSaved:i.lastSaved?.toDate()||new Date}}catch(e){return console.error("Error fetching draft:",e),null}}async function d(e){try{let r=(0,t.doc)(a.db,"drafts",e);return await (0,t.deleteDoc)(r),{success:!0}}catch(e){return console.error("Error deleting draft:",e),{success:!1,error:"Taslak silinemedi"}}}e.s(["autoSaveDraft",0,o,"deleteDraft",()=>d,"getDraftById",()=>l,"getDrafts",()=>c,"saveDraft",()=>i])},30525,e=>{"use strict";var t=e.i(43476),a=e.i(932),r=e.i(71645),s=e.i(57951),i=e.i(18566),n=e.i(27116);function o({initialDraft:e}){let{user:a}=(0,s.useAuth)(),o=(0,i.useRouter)(),[c,l]=(0,r.useState)(e?.title||""),[d,u]=(0,r.useState)(e?.content||""),[f,v]=(0,r.useState)(e?.category||""),[h,m]=(0,r.useState)(e?.excerpt||""),[y,p]=(0,r.useState)(e?.coverImage||""),[g,j]=(0,r.useState)(e?.id||null),[x,b]=(0,r.useState)(!1),[S,D]=(0,r.useState)(e?.lastSaved?.toDate()||null),[k,w]=(0,r.useState)("saved");(0,r.useEffect)(()=>{if(!a||!c)return;let e=setTimeout(async()=>{w("saving");let e={userId:a.uid,title:c,content:d,category:f,excerpt:h,coverImage:y,autoSaveEnabled:!0};try{if(g)await (0,n.autoSaveDraft)(g,e),D(new Date),w("saved");else if(c.length>3){let t=await (0,n.saveDraft)(e);t.success&&t.draftId&&(j(t.draftId),D(new Date),w("saved"))}}catch(e){console.error("Auto-save error:",e),w("error")}},2e3);return()=>clearTimeout(e)},[c,d,f,h,y,a,g]);let N=async()=>{if(g&&a){b(!0);try{let e=await a.getIdToken(),t=await fetch("/api/create-story",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:c,content:d,excerpt:h,category:f,coverImage:y,idToken:e})}),r=await t.json();if(t.ok&&r.success)await (0,n.deleteDraft)(g),o.push(`/story/${r.storyId}`);else{let e=r.details?r.details.join("\n"):r.error||"Yayınlama başarısız";alert("Hata:\n"+e)}}catch(e){console.error("Publish error:",e),alert("Bir hata oluştu. Lütfen tekrar deneyin.")}finally{b(!1)}}};return(0,t.jsxs)("div",{className:"draft-editor",children:[(0,t.jsxs)("div",{className:"editor-header",children:[(0,t.jsxs)("div",{className:"save-status",children:["saving"===k&&"Kaydediliyor...","saved"===k&&S&&`Son kayıt: ${S.toLocaleTimeString()}`,"error"===k&&"Kayıt hatası!"]}),(0,t.jsx)("div",{className:"editor-actions",children:(0,t.jsx)("button",{className:"publish-button",onClick:N,disabled:x||!c||!d,children:x?"Yayınlanıyor...":"Yayınla"})})]}),(0,t.jsxs)("div",{className:"editor-form",children:[(0,t.jsx)("input",{type:"text",className:"editor-title",placeholder:"Hikaye Başlığı",value:c,onChange:e=>l(e.target.value)}),(0,t.jsxs)("select",{className:"editor-category",value:f,onChange:e=>v(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Kategori Seçin"}),(0,t.jsx)("option",{value:"Macera",children:"Macera"}),(0,t.jsx)("option",{value:"Bilim Kurgu",children:"Bilim Kurgu"}),(0,t.jsx)("option",{value:"Romantik",children:"Romantik"}),(0,t.jsx)("option",{value:"Korku",children:"Korku"}),(0,t.jsx)("option",{value:"Fantastik",children:"Fantastik"}),(0,t.jsx)("option",{value:"Dram",children:"Dram"}),(0,t.jsx)("option",{value:"Komedi",children:"Komedi"})]}),(0,t.jsx)("textarea",{className:"editor-excerpt",placeholder:"Kısa Açıklama (Özet)",value:h,onChange:e=>m(e.target.value),rows:3}),(0,t.jsx)("textarea",{className:"editor-content",placeholder:"Hikayenizi buraya yazın...",value:d,onChange:e=>u(e.target.value),rows:15})]})]})}function c(){let{user:e,loading:a}=(0,s.useAuth)(),c=(0,i.useRouter)(),l=(0,i.useSearchParams)().get("draftId"),[d,u]=(0,r.useState)(void 0),[f,v]=(0,r.useState)(!!l);return((0,r.useEffect)(()=>{a||e||c.push("/")},[e,a,c]),(0,r.useEffect)(()=>{l&&e&&t();async function t(){try{let t=await (0,n.getDraftById)(l);t&&t.userId===e?.uid?u(t):c.push("/create")}catch(e){console.error("Error loading draft:",e)}finally{v(!1)}}},[l,e,c]),a||f)?(0,t.jsx)("div",{className:"create-page",children:(0,t.jsx)("div",{className:"create-container",children:(0,t.jsxs)("div",{className:"loading-state",children:[(0,t.jsx)("div",{className:"spinner"}),(0,t.jsx)("p",{children:"Yükleniyor..."})]})})}):e?(0,t.jsx)("div",{className:"create-page",children:(0,t.jsxs)("div",{className:"create-container",children:[(0,t.jsxs)("div",{className:"create-header",children:[(0,t.jsxs)("h1",{className:"page-title",children:[(0,t.jsx)("span",{className:"title-icon",children:"✍️"}),d?"Taslağı Düzenle":"Yeni Hikaye Yaz"]}),(0,t.jsx)("p",{className:"page-subtitle",children:d?"Kaldığınız yerden devam edin...":"Hayal gücünüzü serbest bırakın ve hikayenizi dünyayla paylaşın"})]}),(0,t.jsx)(o,{initialDraft:d})]})}):null}function l(){let e,s=(0,a.c)(1);return s[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"loading-state",children:(0,t.jsx)("div",{className:"spinner"})}),children:(0,t.jsx)(c,{})}),s[0]=e):e=s[0],e}e.s(["default",()=>l],30525)},43987,e=>{e.v(t=>Promise.all(["static/chunks/749b5d99de03c5da.js"].map(t=>e.l(t))).then(()=>t(26633)))}]);