(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,26633,e=>{"use strict";e.i(36180);var t=e.i(98925),r=e.i(53699);let a=(0,t.collection)(r.db,"stories"),n=(0,t.collection)(r.db,"comments");async function s(){console.warn("âš ï¸ getStories() is deprecated. Use getStoriesPaginated() for better performance.");try{let e=(0,t.query)(a,(0,t.orderBy)("createdAt","desc"));return(await (0,t.getDocs)(e)).docs.map(e=>{let t=e.data();return{id:e.id,...t,createdAt:t.createdAt?.toDate()||new Date}})}catch(e){return console.error("Error fetching stories:",e),[]}}async function o(e){try{let a=(0,t.doc)(r.db,"stories",e),n=await (0,t.getDoc)(a);if(!n.exists())return null;let s=n.data();return{id:n.id,...s,createdAt:s.createdAt?.toDate()||new Date}}catch(e){return console.error("Error fetching story:",e),null}}async function i(e){try{let r=(0,t.query)(n,(0,t.where)("storyId","==",e),(0,t.orderBy)("createdAt","desc")),a=(await (0,t.getDocs)(r)).docs.map(e=>{let t=e.data();return{id:e.id,...t,createdAt:t.createdAt?.toDate()||new Date}});return l(a)}catch(e){return console.error("Error fetching comments:",e),[]}}function l(e){let t=new Map,r=[];return e.forEach(e=>{t.set(e.id,{...e,replies:[]})}),e.forEach(e=>{let a=t.get(e.id);a&&r.push(a)}),r}async function c(e){try{return(await (0,t.addDoc)(n,{...e,createdAt:t.Timestamp.now()})).id}catch(e){throw console.error("Error adding comment:",e),e}}async function d(e){try{return(await (0,t.addDoc)(a,{...e,createdAt:t.Timestamp.now()})).id}catch(e){throw console.error("Error adding story:",e),e}}async function m(e){try{let a=(0,t.doc)(r.db,"stories",e);await (0,t.runTransaction)(r.db,async e=>{if(!(await e.get(a)).exists())throw Error("Story does not exist!");e.update(a,{"stats.views":(0,t.increment)(1)})})}catch(e){console.error("Error incrementing story views:",e)}}async function x(e,a){try{let n=(0,t.doc)(r.db,"stories",e);await (0,t.updateDoc)(n,{...a,updatedAt:t.Timestamp.now()})}catch(e){throw console.error("Error updating story:",e),e}}async function p(e){try{let a=(0,t.doc)(r.db,"stories",e);await (0,t.deleteDoc)(a)}catch(e){throw console.error("Error deleting story:",e),e}}function u(e,r){let n=r?(0,t.query)(a,(0,t.orderBy)("createdAt","desc"),(0,t.limit)(r)):(0,t.query)(a,(0,t.orderBy)("createdAt","desc"));return(0,t.onSnapshot)(n,t=>{e(t.docs.map(e=>{let t=e.data();return{id:e.id,...t,createdAt:t.createdAt?.toDate()||new Date}}))},e=>{console.error("Error in stories subscription:",e)})}function h(e,a){let n=(0,t.doc)(r.db,"stories",e);return(0,t.onSnapshot)(n,e=>{if(e.exists()){let t=e.data();a({id:e.id,...t,createdAt:t.createdAt?.toDate()||new Date})}else a(null)},e=>{console.error("Error in story subscription:",e)})}function g(e,r){let a=(0,t.query)(n,(0,t.where)("storyId","==",e),(0,t.orderBy)("createdAt","desc"));return(0,t.onSnapshot)(a,e=>{r(l(e.docs.map(e=>{let t=e.data();return{id:e.id,...t,createdAt:t.createdAt?.toDate()||new Date}})))},e=>{console.error("Error in comments subscription:",e)})}async function b(e=12,r){try{let n=(0,t.query)(a,(0,t.orderBy)("createdAt","desc"),(0,t.limit)(e));r&&(n=(0,t.query)(a,(0,t.orderBy)("createdAt","desc"),(0,t.startAfter)(r),(0,t.limit)(e)));let s=await (0,t.getDocs)(n),o=s.docs.map(e=>{let t=e.data();return{id:e.id,...t,createdAt:t.createdAt?.toDate()||new Date}}).filter(e=>"DELETED"!==e.status),i=s.docs[s.docs.length-1]||null;return{stories:o,lastDoc:i}}catch(e){return console.error("Error fetching paginated stories:",e),{stories:[],lastDoc:null}}}e.s(["addComment",()=>c,"addStory",()=>d,"deleteStory",()=>p,"getCommentsByStoryId",()=>i,"getStories",()=>s,"getStoriesPaginated",()=>b,"getStoryById",()=>o,"incrementStoryViews",()=>m,"subscribeToComments",()=>g,"subscribeToStories",()=>u,"subscribeToStory",()=>h,"updateStory",()=>x])},6062,74161,e=>{"use strict";var t=e.i(43476),r=e.i(932),a=e.i(71645),n=e.i(57951);function s({isOpen:e,onClose:r,targetId:s,targetType:o,targetContent:i}){let{user:l}=(0,n.useAuth)(),[c,d]=(0,a.useState)("spam"),[m,x]=(0,a.useState)(""),[p,u]=(0,a.useState)(!1),[h,g]=(0,a.useState)(!1);if(!e)return null;let b=async e=>{if(e.preventDefault(),l){u(!0);try{let e=await l.getIdToken();(await fetch("/api/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetId:s,targetType:o,targetContent:i,reason:c,description:m,idToken:e})})).ok?(g(!0),setTimeout(()=>{r(),g(!1),x(""),d("spam")},2e3)):alert("Rapor gÃ¶nderilirken bir hata oluÅŸtu.")}catch(e){console.error("Report error:",e),alert("Bir hata oluÅŸtu.")}finally{u(!1)}}};return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,t.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md overflow-hidden animate-scale-in",children:h?(0,t.jsxs)("div",{className:"p-8 text-center",children:[(0,t.jsx)("div",{className:"text-5xl mb-4",children:"âœ…"}),(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-800 dark:text-white mb-2",children:"Rapor GÃ¶nderildi"}),(0,t.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Bildiriminiz iÃ§in teÅŸekkÃ¼rler. Ä°ncelenecektir."})]}):(0,t.jsxs)("form",{onSubmit:b,className:"p-6",children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-800 dark:text-white mb-4",children:"Ä°Ã§eriÄŸi Raporla"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Sebep"}),(0,t.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,t.jsx)("option",{value:"spam",children:"Spam / Reklam"}),(0,t.jsx)("option",{value:"harassment",children:"Taciz / ZorbalÄ±k"}),(0,t.jsx)("option",{value:"inappropriate",children:"Uygunsuz Ä°Ã§erik"}),(0,t.jsx)("option",{value:"other",children:"DiÄŸer"})]})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"AÃ§Ä±klama (Opsiyonel)"}),(0,t.jsx)("textarea",{value:m,onChange:e=>x(e.target.value),className:"w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-24 resize-none",placeholder:"Daha fazla detay..."})]}),(0,t.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,t.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Ä°ptal"}),(0,t.jsx)("button",{type:"submit",disabled:p,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:p?"GÃ¶nderiliyor...":"Raporla"})]})]})})})}function o(e){let n,o,i,l,c,d=(0,r.c)(12),{targetId:m,targetType:x,targetContent:p,className:u}=e,[h,g]=(0,a.useState)(!1);d[0]===Symbol.for("react.memo_cache_sentinel")?(n=()=>g(!0),d[0]=n):n=d[0];let b=`text-gray-400 hover:text-red-500 transition-colors ${void 0===u?"":u}`;return d[1]!==b?(o=(0,t.jsx)("button",{onClick:n,className:b,title:"Raporla",children:"ðŸš©"}),d[1]=b,d[2]=o):o=d[2],d[3]===Symbol.for("react.memo_cache_sentinel")?(i=()=>g(!1),d[3]=i):i=d[3],d[4]!==h||d[5]!==p||d[6]!==m||d[7]!==x?(l=(0,t.jsx)(s,{isOpen:h,onClose:i,targetId:m,targetType:x,targetContent:p}),d[4]=h,d[5]=p,d[6]=m,d[7]=x,d[8]=l):l=d[8],d[9]!==o||d[10]!==l?(c=(0,t.jsxs)(t.Fragment,{children:[o,l]}),d[9]=o,d[10]=l,d[11]=c):c=d[11],c}function i({storyId:e,className:r=""}){let{user:s}=(0,n.useAuth)(),[o,i]=(0,a.useState)(!1),[l,c]=(0,a.useState)([]),[d,m]=(0,a.useState)(!1),[x,p]=(0,a.useState)(""),[u,h]=(0,a.useState)(!1),g=async()=>{if(s){m(!0);try{let e=await fetch(`/api/collections?userId=${s.uid}`),t=await e.json();t.collections&&c(t.collections)}catch(e){console.error("Error fetching collections:",e)}finally{m(!1)}}},b=async()=>{if(x.trim()&&s){h(!0);try{let e=await s.getIdToken();(await fetch("/api/collections",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:x,idToken:e})})).ok&&(p(""),g())}catch(e){console.error("Error creating collection:",e)}finally{h(!1)}}},f=async t=>{if(!s)return;let r=t.storyIds?.includes(e);try{let a=await s.getIdToken();(await fetch(`/api/collections/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:r?"remove_story":"add_story",storyId:e,idToken:a})})).ok&&c(l.map(a=>{if(a.id===t.id){let t=r?a.storyIds.filter(t=>t!==e):[...a.storyIds||[],e];return{...a,storyIds:t}}return a}))}catch(e){console.error("Error updating collection:",e)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>{s?(i(!0),g()):alert("LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n.")},className:`text-gray-400 hover:text-indigo-500 transition-colors ${r}`,title:"Listeye Ekle",children:"ðŸ”–"}),o&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md overflow-hidden animate-scale-in",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center",children:[(0,t.jsx)("h3",{className:"font-bold text-gray-800 dark:text-white",children:"Listeye Ekle"}),(0,t.jsx)("button",{onClick:()=>i(!1),className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),(0,t.jsx)("div",{className:"p-4 max-h-64 overflow-y-auto",children:d?(0,t.jsx)("div",{className:"text-center py-4",children:"YÃ¼kleniyor..."}):0===l.length?(0,t.jsx)("div",{className:"text-center py-4 text-gray-500",children:"HenÃ¼z listeniz yok."}):(0,t.jsx)("div",{className:"space-y-2",children:l.map(r=>{let a=r.storyIds?.includes(e);return(0,t.jsxs)("button",{onClick:()=>f(r),className:`w-full flex items-center justify-between p-3 rounded-lg border transition-all ${a?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[(0,t.jsx)("span",{className:"font-medium",children:r.name}),a&&(0,t.jsx)("span",{children:"âœ“"})]},r.id)})})}),(0,t.jsx)("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-100 dark:border-gray-700",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:x,onChange:e=>p(e.target.value),placeholder:"Yeni liste adÄ±...",className:"flex-1 p-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm"}),(0,t.jsx)("button",{onClick:b,disabled:u||!x.trim(),className:"px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 text-sm font-medium",children:u?"...":"OluÅŸtur"})]})})]})})]})}e.s(["default",()=>o],6062),e.s(["default",()=>i],74161)},44316,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566),n=e.i(22016),s=e.i(26633),o=e.i(57951),i=e.i(25661),l=e.i(932),c=e.i(6062);function d(e){let r,a,n,s,o,i,m,x,p,u,h,g,b,f,y=(0,l.c)(35),{comment:j,depth:k}=e,N=void 0===k?0:k,w=N>0?`${2*N}rem`:"0";return y[0]!==w?(r={marginLeft:w},y[0]=w,y[1]=r):r=y[1],y[2]!==j.author.avatar?(a=(0,t.jsx)("span",{className:"author-avatar",children:j.author.avatar}),y[2]=j.author.avatar,y[3]=a):a=y[3],y[4]!==j.author.name?(n=(0,t.jsx)("span",{className:"author-name",children:j.author.name}),y[4]=j.author.name,y[5]=n):n=y[5],y[6]!==j.createdAt?(s=function(e){let t=Math.floor((new Date().getTime()-e.getTime())/36e5),r=Math.floor(t/24);return t<1?"Az Ã¶nce":t<24?`${t} saat \xf6nce`:r<7?`${r} g\xfcn \xf6nce`:e.toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric"})}(j.createdAt),y[6]=j.createdAt,y[7]=s):s=y[7],y[8]!==s?(o=(0,t.jsx)("span",{className:"comment-date",children:s}),y[8]=s,y[9]=o):o=y[9],y[10]!==n||y[11]!==o?(i=(0,t.jsxs)("div",{className:"author-info",children:[n,o]}),y[10]=n,y[11]=o,y[12]=i):i=y[12],y[13]!==a||y[14]!==i?(m=(0,t.jsxs)("div",{className:"comment-author",children:[a,i]}),y[13]=a,y[14]=i,y[15]=m):m=y[15],y[16]!==j.content||y[17]!==j.id?(x=(0,t.jsx)(c.default,{targetId:j.id,targetType:"comment",targetContent:j.content,className:"text-xs opacity-50 hover:opacity-100"}),y[16]=j.content,y[17]=j.id,y[18]=x):x=y[18],y[19]!==m||y[20]!==x?(p=(0,t.jsxs)("div",{className:"comment-header",children:[m,x]}),y[19]=m,y[20]=x,y[21]=p):p=y[21],y[22]!==j.content?(u=(0,t.jsx)("p",{className:"comment-content",children:j.content}),y[22]=j.content,y[23]=u):u=y[23],y[24]===Symbol.for("react.memo_cache_sentinel")?(h=(0,t.jsxs)("button",{className:"reply-button",children:[(0,t.jsx)("span",{children:"ðŸ’¬"}),"YanÄ±tla"]}),y[24]=h):h=y[24],y[25]!==p||y[26]!==u?(g=(0,t.jsxs)("div",{className:"comment-card",children:[p,u,h]}),y[25]=p,y[26]=u,y[27]=g):g=y[27],y[28]!==j.replies||y[29]!==N?(b=j.replies&&j.replies.length>0&&(0,t.jsx)("div",{className:"comment-replies",children:j.replies.map(e=>(0,t.jsx)(d,{comment:e,depth:N+1},e.id))}),y[28]=j.replies,y[29]=N,y[30]=b):b=y[30],y[31]!==g||y[32]!==b||y[33]!==r?(f=(0,t.jsxs)("div",{style:r,className:"comment-card-wrapper",children:[g,b]}),y[31]=g,y[32]=b,y[33]=r,y[34]=f):f=y[34],f}function m(e){let a,n,s,o,i,c,d,m,x,p,u=(0,l.c)(26),{onSubmit:h,placeholder:g,disabled:b}=e,f=void 0===g?"Yorumunuzu yazÄ±n...":g,y=void 0!==b&&b,[j,k]=(0,r.useState)("");u[0]!==j||u[1]!==h?(a=e=>{e.preventDefault(),j.trim()&&j.length<=500&&(h(j.trim()),k(""))},u[0]=j,u[1]=h,u[2]=a):a=u[2];let N=a,w=500-j.length,v=w<50;u[3]===Symbol.for("react.memo_cache_sentinel")?(n=(0,t.jsx)("div",{className:"form-header",children:(0,t.jsx)("h3",{children:"ðŸ’¬ Yorum Yap"})}),u[3]=n):n=u[3],u[4]===Symbol.for("react.memo_cache_sentinel")?(s=e=>k(e.target.value),u[4]=s):s=u[4],u[5]!==j||u[6]!==y||u[7]!==f?(o=(0,t.jsx)("textarea",{value:j,onChange:s,placeholder:f,maxLength:500,rows:4,className:"comment-textarea",disabled:y}),u[5]=j,u[6]=y,u[7]=f,u[8]=o):o=u[8];let S=`char-counter ${v?"warning":""}`;u[9]!==w||u[10]!==S?(i=(0,t.jsxs)("span",{className:S,children:[w," karakter kaldÄ±"]}),u[9]=w,u[10]=S,u[11]=i):i=u[11],u[12]!==j||u[13]!==y?(c=!j.trim()||j.length>500||y,u[12]=j,u[13]=y,u[14]=c):c=u[14],u[15]===Symbol.for("react.memo_cache_sentinel")?(d=(0,t.jsx)("span",{children:"ðŸ“¤"}),u[15]=d):d=u[15];let C=y?"GÃ¶nderiliyor...":"GÃ¶nder";return u[16]!==C||u[17]!==c?(m=(0,t.jsxs)("button",{type:"submit",disabled:c,className:"submit-button",children:[d,C]}),u[16]=C,u[17]=c,u[18]=m):m=u[18],u[19]!==m||u[20]!==i?(x=(0,t.jsxs)("div",{className:"form-footer",children:[i,m]}),u[19]=m,u[20]=i,u[21]=x):x=u[21],u[22]!==N||u[23]!==x||u[24]!==o?(p=(0,t.jsxs)("form",{onSubmit:N,className:"comment-form",children:[n,o,x]}),u[22]=N,u[23]=x,u[24]=o,u[25]=p):p=u[25],p}function x({storyId:e,storyAuthorId:a,storyTitle:n,initialComments:l}){let{user:c}=(0,o.useAuth)(),[x,p]=(0,r.useState)(l),[u,h]=(0,r.useState)(!1),[g,b]=(0,r.useState)(!1),f=async t=>{if(!c)return void b(!0);h(!0);try{let r={storyId:e,author:{name:c.displayName||"KullanÄ±cÄ±",avatar:c.photoURL||"ðŸ‘¤"},content:t,replies:[]},o=await (0,s.addComment)(r),l=await (0,s.getCommentsByStoryId)(e);if(p(l),a&&a!==c.uid)try{await (0,i.createNotification)({userId:a,type:"comment",actorId:c.uid,actorName:c.displayName||"KullanÄ±cÄ±",actorAvatar:c.photoURL||"ðŸ‘¤",storyId:e,storyTitle:n,commentId:o,message:"hikayenize yorum yaptÄ±"})}catch(e){console.error("Error creating notification:",e)}}catch(e){console.error("Error adding comment:",e),alert("Yorum eklenirken bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.")}finally{h(!1)}};return(0,t.jsxs)("div",{className:"comment-section",children:[(0,t.jsxs)("div",{className:"section-header",children:[(0,t.jsx)("h2",{children:"ðŸ’¬ Yorumlar"}),(0,t.jsxs)("span",{className:"comment-count",children:[x.length," yorum"]})]}),!c&&g?(0,t.jsxs)("div",{className:"login-prompt",children:[(0,t.jsx)("span",{className:"prompt-icon",children:"ðŸ”"}),(0,t.jsx)("p",{children:"Yorum yapmak iÃ§in giriÅŸ yapmalÄ±sÄ±nÄ±z."}),(0,t.jsx)("p",{className:"prompt-hint",children:'SaÄŸ Ã¼st kÃ¶ÅŸedeki "GiriÅŸ Yap" butonunu kullanÄ±n.'})]}):(0,t.jsx)(m,{onSubmit:f,disabled:u}),(0,t.jsx)("div",{className:"comments-list",children:0===x.length?(0,t.jsxs)("div",{className:"empty-state",children:[(0,t.jsx)("span",{className:"empty-icon",children:"ðŸ’­"}),(0,t.jsx)("p",{children:"HenÃ¼z yorum yapÄ±lmamÄ±ÅŸ. Ä°lk yorumu siz yapÄ±n!"})]}):x.map(e=>(0,t.jsx)(d,{comment:e},e.id))})]})}function p(){return"undefined"!=typeof navigator&&"share"in navigator}async function u(e){if(!p())return!1;try{return await navigator.share(e),!0}catch(e){return console.log("Share cancelled or failed:",e),!1}}async function h(e){if("undefined"==typeof navigator)return!1;try{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();let r=document.execCommand("copy");return document.body.removeChild(t),r}catch(e){return console.error("Failed to copy to clipboard:",e),!1}}function g(e){let a,n,s,o,i,c,d,m,x,g,f,y,j,k,N,w,v,S,C,T,z,A,I,E,R,_,D,B,$,L,F,O,P,Y=(0,l.c)(71),{storyId:W,storyTitle:M,onClose:U}=e,[H,K]=(0,r.useState)(!1),[G,q]=(0,r.useState)(!1);if(Y[0]===Symbol.for("react.memo_cache_sentinel")?(a=()=>{q(p())},n=[],Y[0]=a,Y[1]=n):(a=Y[0],n=Y[1]),(0,r.useEffect)(a,n),Y[2]!==W||Y[3]!==M)s={title:M,text:`"${M}" hikayesini okuyun - Fabula`,url:`${window.location.origin}/story/${W}`},Y[2]=W,Y[3]=M,Y[4]=s;else s=Y[4];let J=s;Y[5]!==U||Y[6]!==J?(o=async()=>{await u(J)&&U()},Y[5]=U,Y[6]=J,Y[7]=o):o=Y[7];let V=o;Y[8]!==J.url?(i=async()=>{await h(J.url)&&(K(!0),setTimeout(()=>{K(!1)},2e3))},Y[8]=J.url,Y[9]=i):i=Y[9];let X=i,Z=b;Y[10]!==U?(c=e=>{e.target===e.currentTarget&&U()},Y[10]=U,Y[11]=c):c=Y[11];let Q=c;Y[12]===Symbol.for("react.memo_cache_sentinel")?(d=(0,t.jsx)("h3",{children:"Hikayeyi PaylaÅŸ"}),Y[12]=d):d=Y[12],Y[13]!==U?(m=(0,t.jsxs)("div",{className:"modal-header",children:[d,(0,t.jsx)("button",{className:"close-button",onClick:U,children:"âœ•"})]}),Y[13]=U,Y[14]=m):m=Y[14],Y[15]!==M?(x=(0,t.jsx)("p",{className:"share-title",children:M}),Y[15]=M,Y[16]=x):x=Y[16],Y[17]!==V||Y[18]!==G?(g=G&&(0,t.jsxs)("button",{className:"web-share-button",onClick:V,children:[(0,t.jsx)("span",{className:"button-icon",children:"ðŸ“±"}),"PaylaÅŸ"]}),Y[17]=V,Y[18]=G,Y[19]=g):g=Y[19],Y[20]!==J.text||Y[21]!==J.url?(f=()=>{let e;return Z((e=new URLSearchParams({text:J.text,url:J.url}),`https://twitter.com/intent/tweet?${e.toString()}`))},Y[20]=J.text,Y[21]=J.url,Y[22]=f):f=Y[22],Y[23]===Symbol.for("react.memo_cache_sentinel")?(y=(0,t.jsx)("span",{className:"social-icon",children:"ð•"}),j=(0,t.jsx)("span",{className:"social-name",children:"Twitter"}),Y[23]=y,Y[24]=j):(y=Y[23],j=Y[24]),Y[25]!==f?(k=(0,t.jsxs)("button",{className:"social-button twitter",onClick:f,title:"Twitter'da paylaÅŸ",children:[y,j]}),Y[25]=f,Y[26]=k):k=Y[26],Y[27]!==J.url?(N=()=>{let e;return Z((e=new URLSearchParams({u:J.url}),`https://www.facebook.com/sharer/sharer.php?${e.toString()}`))},Y[27]=J.url,Y[28]=N):N=Y[28],Y[29]===Symbol.for("react.memo_cache_sentinel")?(w=(0,t.jsx)("span",{className:"social-icon",children:"f"}),v=(0,t.jsx)("span",{className:"social-name",children:"Facebook"}),Y[29]=w,Y[30]=v):(w=Y[29],v=Y[30]),Y[31]!==N?(S=(0,t.jsxs)("button",{className:"social-button facebook",onClick:N,title:"Facebook'ta paylaÅŸ",children:[w,v]}),Y[31]=N,Y[32]=S):S=Y[32],Y[33]!==J.text||Y[34]!==J.url?(C=()=>{var e,t;let r;return Z((e=J.text,t=J.url,r=new URLSearchParams({text:`${e} ${t}`}),`https://wa.me/?${r.toString()}`))},Y[33]=J.text,Y[34]=J.url,Y[35]=C):C=Y[35],Y[36]===Symbol.for("react.memo_cache_sentinel")?(T=(0,t.jsx)("span",{className:"social-icon",children:"ðŸ“±"}),z=(0,t.jsx)("span",{className:"social-name",children:"WhatsApp"}),Y[36]=T,Y[37]=z):(T=Y[36],z=Y[37]),Y[38]!==C?(A=(0,t.jsxs)("button",{className:"social-button whatsapp",onClick:C,title:"WhatsApp'ta paylaÅŸ",children:[T,z]}),Y[38]=C,Y[39]=A):A=Y[39],Y[40]!==J.url?(I=()=>{let e;return Z((e=new URLSearchParams({url:J.url}),`https://www.linkedin.com/sharing/share-offsite/?${e.toString()}`))},Y[40]=J.url,Y[41]=I):I=Y[41],Y[42]===Symbol.for("react.memo_cache_sentinel")?(E=(0,t.jsx)("span",{className:"social-icon",children:"in"}),R=(0,t.jsx)("span",{className:"social-name",children:"LinkedIn"}),Y[42]=E,Y[43]=R):(E=Y[42],R=Y[43]),Y[44]!==I?(_=(0,t.jsxs)("button",{className:"social-button linkedin",onClick:I,title:"LinkedIn'de paylaÅŸ",children:[E,R]}),Y[44]=I,Y[45]=_):_=Y[45],Y[46]!==k||Y[47]!==S||Y[48]!==A||Y[49]!==_?(D=(0,t.jsxs)("div",{className:"social-buttons",children:[k,S,A,_]}),Y[46]=k,Y[47]=S,Y[48]=A,Y[49]=_,Y[50]=D):D=Y[50],Y[51]!==J.url?(B=(0,t.jsx)("input",{type:"text",value:J.url,readOnly:!0,className:"link-input"}),Y[51]=J.url,Y[52]=B):B=Y[52];let ee=`copy-button ${H?"copied":""}`,et=H?"âœ“ KopyalandÄ±":"\uD83D\uDCCB Kopyala";return Y[53]!==X||Y[54]!==ee||Y[55]!==et?($=(0,t.jsx)("button",{className:ee,onClick:X,children:et}),Y[53]=X,Y[54]=ee,Y[55]=et,Y[56]=$):$=Y[56],Y[57]!==B||Y[58]!==$?(L=(0,t.jsxs)("div",{className:"copy-link-section",children:[B,$]}),Y[57]=B,Y[58]=$,Y[59]=L):L=Y[59],Y[60]!==g||Y[61]!==D||Y[62]!==L||Y[63]!==x?(F=(0,t.jsxs)("div",{className:"modal-content",children:[x,g,D,L]}),Y[60]=g,Y[61]=D,Y[62]=L,Y[63]=x,Y[64]=F):F=Y[64],Y[65]!==F||Y[66]!==m?(O=(0,t.jsxs)("div",{className:"share-modal",children:[m,F]}),Y[65]=F,Y[66]=m,Y[67]=O):O=Y[67],Y[68]!==Q||Y[69]!==O?(P=(0,t.jsx)("div",{className:"modal-backdrop",onClick:Q,children:O}),Y[68]=Q,Y[69]=O,Y[70]=P):P=Y[70],P}function b(e){window.open(e,"_blank","width=600,height=400")}function f(e){let a,n,s,o,i,c,d,m=(0,l.c)(13),{storyId:x,storyTitle:p,size:u}=e,[h,b]=(0,r.useState)(!1);m[0]===Symbol.for("react.memo_cache_sentinel")?(a={small:"share-button-small",medium:"share-button-medium",large:"share-button-large"},m[0]=a):a=m[0];let f=a,y=`share-button ${f[void 0===u?"medium":u]}`;return m[1]===Symbol.for("react.memo_cache_sentinel")?(n=()=>b(!0),m[1]=n):n=m[1],m[2]===Symbol.for("react.memo_cache_sentinel")?(s=(0,t.jsx)("span",{className:"share-icon",children:"ðŸ“¤"}),o=(0,t.jsx)("span",{className:"share-text",children:"PaylaÅŸ"}),m[2]=s,m[3]=o):(s=m[2],o=m[3]),m[4]!==y?(i=(0,t.jsxs)("button",{className:y,onClick:n,title:"Hikayeyi paylaÅŸ",children:[s,o]}),m[4]=y,m[5]=i):i=m[5],m[6]!==h||m[7]!==x||m[8]!==p?(c=h&&(0,t.jsx)(g,{storyId:x,storyTitle:p,onClose:()=>b(!1)}),m[6]=h,m[7]=x,m[8]=p,m[9]=c):c=m[9],m[10]!==i||m[11]!==c?(d=(0,t.jsxs)(t.Fragment,{children:[i,c]}),m[10]=i,m[11]=c,m[12]=d):d=m[12],d}var y=e.i(74161);function j(e){let a,n,s,o,i,c,d,m,x,p,u=(0,l.c)(22),{onSettingsChange:h,initialSettings:g}=e,[b,f]=(0,r.useState)(!1);u[0]!==g?(a=g||{font:"sans",size:"medium",theme:"light"},u[0]=g,u[1]=a):a=u[1];let[y,j]=(0,r.useState)(a),k=(0,r.useRef)(null);u[2]===Symbol.for("react.memo_cache_sentinel")?(n=()=>{let e=function(e){k.current&&!k.current.contains(e.target)&&f(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},s=[],u[2]=n,u[3]=s):(n=u[2],s=u[3]),(0,r.useEffect)(n,s),u[4]!==h||u[5]!==y?(o=e=>{let t={...y,...e};j(t),h(t),localStorage.setItem("fabula-reading-settings",JSON.stringify(t))},u[4]=h,u[5]=y,u[6]=o):o=u[6];let N=o;u[7]===Symbol.for("react.memo_cache_sentinel")?(i={position:"relative",zIndex:50},u[7]=i):i=u[7],u[8]!==b?(c=()=>f(!b),u[8]=b,u[9]=c):c=u[9];let w=b?"inset 5px 5px 10px #bebebe, inset -5px -5px 10px #ffffff":"5px 5px 10px #bebebe, -5px -5px 10px #ffffff";return u[10]!==w?(d={background:"#e0e5ec",border:"none",fontSize:"1.5rem",cursor:"pointer",width:"44px",height:"44px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",boxShadow:w,color:"#4a5568"},u[10]=w,u[11]=d):d=u[11],u[12]!==c||u[13]!==d?(m=(0,t.jsx)("button",{onClick:c,className:"reading-settings-toggle",title:"Okuma AyarlarÄ±",style:d,children:"Aa"}),u[12]=c,u[13]=d,u[14]=m):m=u[14],u[15]!==b||u[16]!==y||u[17]!==N?(x=b&&(0,t.jsxs)("div",{className:"reading-settings-menu",style:{position:"absolute",top:"100%",right:0,marginTop:"16px",background:"#e0e5ec",border:"none",borderRadius:"20px",padding:"20px",boxShadow:"9px 9px 16px rgb(163,177,198,0.6), -9px -9px 16px rgba(255,255,255, 0.5)",width:"300px",color:"#4a5568",zIndex:100},children:[(0,t.jsxs)("div",{className:"setting-group",style:{marginBottom:"16px"},children:[(0,t.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.875rem",fontWeight:600},children:"YazÄ± Tipi"}),(0,t.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,t.jsx)("button",{onClick:()=>N({font:"sans"}),style:{flex:1,padding:"8px",border:"none",borderRadius:"10px",background:"#e0e5ec",boxShadow:"sans"===y.font?"inset 3px 3px 6px #bebebe, inset -3px -3px 6px #ffffff":"3px 3px 6px #bebebe, -3px -3px 6px #ffffff",cursor:"pointer",fontFamily:"sans-serif",color:"#4a5568",fontWeight:"sans"===y.font?"bold":"normal",transition:"all 0.2s ease"},children:"Sans"}),(0,t.jsx)("button",{onClick:()=>N({font:"serif"}),style:{flex:1,padding:"8px",border:"none",borderRadius:"10px",background:"#e0e5ec",boxShadow:"serif"===y.font?"inset 3px 3px 6px #bebebe, inset -3px -3px 6px #ffffff":"3px 3px 6px #bebebe, -3px -3px 6px #ffffff",cursor:"pointer",fontFamily:"serif",color:"#4a5568",fontWeight:"serif"===y.font?"bold":"normal",transition:"all 0.2s ease"},children:"Serif"}),(0,t.jsx)("button",{onClick:()=>N({font:"mono"}),style:{flex:1,padding:"8px",border:"none",borderRadius:"10px",background:"#e0e5ec",boxShadow:"mono"===y.font?"inset 3px 3px 6px #bebebe, inset -3px -3px 6px #ffffff":"3px 3px 6px #bebebe, -3px -3px 6px #ffffff",cursor:"pointer",fontFamily:"monospace",color:"#4a5568",fontWeight:"mono"===y.font?"bold":"normal",transition:"all 0.2s ease"},children:"Mono"})]})]}),(0,t.jsxs)("div",{className:"setting-group",style:{marginBottom:"16px"},children:[(0,t.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.875rem",fontWeight:600},children:"Boyut"}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,t.jsx)("button",{onClick:()=>N({size:"small"}),style:{border:"none",background:"none",cursor:"pointer",fontSize:"14px",fontWeight:"small"===y.size?"bold":"normal"},children:"A"}),(0,t.jsx)("div",{style:{flex:1,height:"4px",background:"#e5e7eb",borderRadius:"2px",position:"relative"},children:(0,t.jsx)("div",{style:{position:"absolute",left:"small"===y.size?"0%":"medium"===y.size?"33%":"large"===y.size?"66%":"100%",top:"50%",transform:"translate(-50%, -50%)",width:"12px",height:"12px",borderRadius:"50%",background:"#3b82f6"}})}),(0,t.jsx)("button",{onClick:()=>N({size:"xlarge"}),style:{border:"none",background:"none",cursor:"pointer",fontSize:"24px",fontWeight:"xlarge"===y.size?"bold":"normal"},children:"A"})]}),(0,t.jsx)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"12px",padding:"0 8px"},children:["small","medium","large","xlarge"].map(e=>(0,t.jsx)("button",{onClick:()=>N({size:e}),style:{width:"32px",height:"32px",border:"none",borderRadius:"50%",background:"#e0e5ec",boxShadow:y.size===e?"inset 3px 3px 6px #bebebe, inset -3px -3px 6px #ffffff":"3px 3px 6px #bebebe, -3px -3px 6px #ffffff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"small"===e?"12px":"medium"===e?"14px":"large"===e?"16px":"18px",fontWeight:"bold",color:y.size===e?"#3b82f6":"#4a5568",transition:"all 0.2s ease"},"aria-label":`Select ${e} size`,children:"A"},e))})]}),(0,t.jsxs)("div",{className:"setting-group",children:[(0,t.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.875rem",fontWeight:600},children:"Tema"}),(0,t.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,t.jsx)("button",{onClick:()=>N({theme:"light"}),style:{flex:1,height:"40px",borderRadius:"10px",border:"none",background:"#e0e5ec",boxShadow:"light"===y.theme?"inset 3px 3px 6px #bebebe, inset -3px -3px 6px #ffffff":"3px 3px 6px #bebebe, -3px -3px 6px #ffffff",color:"#000",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"light"===y.theme?"bold":"normal",transition:"all 0.2s ease"},children:"AÃ§Ä±k"}),(0,t.jsx)("button",{onClick:()=>N({theme:"sepia"}),style:{flex:1,height:"40px",borderRadius:"10px",border:"none",background:"#e0e5ec",boxShadow:"sepia"===y.theme?"inset 3px 3px 6px #bebebe, inset -3px -3px 6px #ffffff":"3px 3px 6px #bebebe, -3px -3px 6px #ffffff",color:"#5b4636",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"sepia"===y.theme?"bold":"normal",transition:"all 0.2s ease"},children:"Sepya"}),(0,t.jsx)("button",{onClick:()=>N({theme:"dark"}),style:{flex:1,height:"40px",borderRadius:"10px",border:"none",background:"#e0e5ec",boxShadow:"dark"===y.theme?"inset 3px 3px 6px #bebebe, inset -3px -3px 6px #ffffff":"3px 3px 6px #bebebe, -3px -3px 6px #ffffff",color:"#1f2937",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"dark"===y.theme?"bold":"normal",transition:"all 0.2s ease"},children:"Koyu"})]})]})]}),u[15]=b,u[16]=y,u[17]=N,u[18]=x):x=u[18],u[19]!==x||u[20]!==m?(p=(0,t.jsxs)("div",{className:"reading-settings-container",ref:k,style:i,children:[m,x]}),u[19]=x,u[20]=m,u[21]=p):p=u[21],p}function k({isOpen:e,onClose:a,storyId:n,nodeId:s,onSuccess:i}){let{user:l}=(0,o.useAuth)(),[c,d]=(0,r.useState)(""),[m,x]=(0,r.useState)(!1);if(!e)return null;let p=async e=>{if(e.preventDefault(),l&&c.trim()){x(!0);try{let e=await l.getIdToken(),t=await fetch(`/api/stories/${n}/propose`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nodeId:s,text:c,idToken:e})}),r=await t.json();r.success?(alert(r.message),i(),a(),d("")):alert(r.error||"Bir hata oluÅŸtu.")}catch(e){console.error("Error proposing branch:",e),alert("Bir hata oluÅŸtu.")}finally{x(!1)}}};return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,t.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md overflow-hidden animate-scale-in",children:(0,t.jsxs)("form",{onSubmit:p,className:"p-6",children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-800 dark:text-white mb-4",children:"Yeni Yol Ã–ner"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Hikayenin gidiÅŸatÄ±nÄ± deÄŸiÅŸtirecek bir seÃ§enek Ã¶nerin."}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SeÃ§enek Metni"}),(0,t.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),className:"w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Ã–rn: Ormana doÄŸru koÅŸ...",maxLength:100}),(0,t.jsxs)("div",{className:"text-right text-xs text-gray-400 mt-1",children:[c.length,"/100"]})]}),(0,t.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,t.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Ä°ptal"}),(0,t.jsx)("button",{type:"submit",disabled:m||!c.trim(),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50",children:m?"GÃ¶nderiliyor...":"Ã–ner"})]})]})})})}function N({story:e,readingSettings:a,onProgressUpdate:n}){let{user:s}=(0,o.useAuth)(),[i,l]=(0,r.useState)(e.startNodeId||"start"),[c,d]=(0,r.useState)([]),[m,x]=(0,r.useState)(null),[p,u]=(0,r.useState)(!1),[h,g]=(0,r.useState)(null),[b,f]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(e.nodes&&e.nodes[i]){let t=e.nodes[i];x(t),!t.isEnding||h||p||y([...c,i])}else console.warn(`Node ${i} not found in story`)},[i,e.nodes]);let y=async t=>{if(s){u(!0);try{let r=await s.getIdToken(),a=await fetch("/api/complete-story",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storyId:e.id,history:t,idToken:r})}),n=await a.json();n.success&&g({xpEarned:n.xpEarned,message:n.message})}catch(e){console.error("Error completing story:",e)}finally{u(!1)}}};if(!m)return(0,t.jsx)("div",{className:"p-4 text-center",children:"YÃ¼kleniyor..."});let j={fontFamily:"serif"===a.font?'ui-serif, Georgia, Cambria, "Times New Roman", Times, serif':"mono"===a.font?"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace":"ui-sans-serif, system-ui, sans-serif",fontSize:"small"===a.size?"0.95rem":"large"===a.size?"1.25rem":"xlarge"===a.size?"1.5rem":"1.1rem",lineHeight:"xlarge"===a.size?"2":"1.8",backgroundColor:"sepia"===a.theme?"#f4ecd8":"dark"===a.theme?"#1f2937":"transparent",color:"sepia"===a.theme?"#433422":"dark"===a.theme?"#e5e7eb":"inherit",padding:"light"!==a.theme?"3rem":"0",borderRadius:"light"!==a.theme?"4px":"0",transition:"all 0.3s ease",boxShadow:"sepia"===a.theme?"inset 20px 0 50px rgba(0,0,0,0.05), 5px 5px 15px rgba(0,0,0,0.1)":"none",borderLeft:"sepia"===a.theme?"2px solid rgba(0,0,0,0.05)":"none",backgroundImage:"sepia"===a.theme?"linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.2) 5%, rgba(255,255,255,0) 10%)":"none"},N={background:"dark"===a.theme?"#374151":"#e0e5ec",border:"none",padding:"16px 24px",borderRadius:"12px",color:"dark"===a.theme?"#e5e7eb":"#4a5568",fontSize:"1rem",fontWeight:600,cursor:"pointer",width:"100%",textAlign:"left",transition:"all 0.2s ease",boxShadow:"dark"===a.theme?"5px 5px 10px #2d3542, -5px -5px 10px #414d5f":"9px 9px 16px rgb(163,177,198,0.6), -9px -9px 16px rgba(255,255,255, 0.5)",marginBottom:"16px"};return(0,t.jsxs)("div",{className:"interactive-story-container",children:[(0,t.jsx)("div",{className:"story-content mb-8",style:j,children:m.content.split("\n\n").map((e,r)=>(0,t.jsx)("p",{style:{marginBottom:"1.5em"},children:e},r))}),(0,t.jsxs)("div",{className:"choices-container",style:{maxWidth:"600px",margin:"0 auto"},children:[m.choices&&m.choices.length>0?(0,t.jsx)("div",{className:"choices-list",children:m.choices.map(e=>(0,t.jsx)("button",{onClick:()=>{var t;let r;return t=e.nextNodeId,void(d(r=[...c,i]),l(t),n&&n([...r,t]))},className:"choice-button",style:N,onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="dark"===a.theme?"6px 6px 12px #2d3542, -6px -6px 12px #414d5f":"12px 12px 20px rgb(163,177,198,0.7), -12px -12px 20px rgba(255,255,255, 0.6)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="dark"===a.theme?"5px 5px 10px #2d3542, -5px -5px 10px #414d5f":"9px 9px 16px rgb(163,177,198,0.6), -9px -9px 16px rgba(255,255,255, 0.5)"},onMouseDown:e=>{e.currentTarget.style.transform="translateY(1px)",e.currentTarget.style.boxShadow="dark"===a.theme?"inset 3px 3px 6px #2d3542, inset -3px -3px 6px #414d5f":"inset 3px 3px 6px #a3b1c6, inset -3px -3px 6px #ffffff"},onMouseUp:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="dark"===a.theme?"6px 6px 12px #2d3542, -6px -6px 12px #414d5f":"12px 12px 20px rgb(163,177,198,0.7), -12px -12px 20px rgba(255,255,255, 0.6)"},children:e.text},e.id))}):(0,t.jsxs)("div",{className:"end-of-story text-center p-8",children:[(0,t.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Son"}),h?(0,t.jsxs)("div",{className:"completion-result animate-fade-in",children:[(0,t.jsx)("p",{className:"text-lg mb-2",children:h.message}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-yellow-500",children:["+",h.xpEarned," XP"]})]}):p?(0,t.jsx)("p",{children:"SonuÃ§lar hesaplanÄ±yor..."}):(0,t.jsx)("p",{children:"Bu hikayenin sonuna geldiniz."})]}),s&&!m.isEnding&&(0,t.jsxs)("div",{className:"mt-8 text-center",children:[(0,t.jsx)("p",{className:"text-gray-500 mb-2 text-sm",children:"AklÄ±nda baÅŸka bir yol mu var?"}),(0,t.jsx)("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300 rounded-lg hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition-colors text-sm font-medium",children:"âœ¨ Yeni Bir Yol Ã–ner"})]}),(0,t.jsx)(k,{isOpen:b,onClose:()=>f(!1),storyId:e.id,nodeId:i,onSuccess:()=>{window.location.reload()}})]})]})}function w({params:e}){let[i,l]=(0,r.useState)(""),[d,m]=(0,r.useState)(null),[p,u]=(0,r.useState)([]),[h,g]=(0,r.useState)(!0),{user:b}=(0,o.useAuth)(),k=(0,a.useRouter)(),[w,v]=(0,r.useState)(!1),[S,C]=(0,r.useState)(!1),[T,z]=(0,r.useState)(""),[A,I]=(0,r.useState)(""),[E,R]=(0,r.useState)(!1),[_,D]=(0,r.useState)({font:"sans",size:"medium",theme:"light"});(0,r.useEffect)(()=>{let e=localStorage.getItem("fabula-reading-settings");if(e)try{D(JSON.parse(e))}catch(e){console.error("Error parsing reading settings:",e)}},[]),(0,r.useEffect)(()=>{!async function(){l((await e).id)}()},[e]),(0,r.useEffect)(()=>{i&&e();async function e(){try{let[e,t]=await Promise.all([(0,s.getStoryById)(i),(0,s.getCommentsByStoryId)(i)]);if(!e)return void(0,a.notFound)();m(e),u(t),(0,s.incrementStoryViews)(i).catch(e=>{console.error("Failed to increment views:",e)})}catch(e){console.error("Error loading story:",e)}finally{g(!1)}}},[i]);let B=e=>e>=1e3?`${(e/1e3).toFixed(1)}k`:e.toString(),$=async()=>{if(confirm("Bu hikayeyi silmek istediÄŸinizden emin misiniz? Bu iÅŸlem geri alÄ±namaz.")){v(!0);try{await (0,s.deleteStory)(i),k.push("/")}catch(e){console.error("Error deleting story:",e),alert("Hikaye silinirken bir hata oluÅŸtu."),v(!1)}}},L=async()=>{if(!T.trim()||!A.trim())return void alert("BaÅŸlÄ±k ve iÃ§erik boÅŸ olamaz.");R(!0);try{await (0,s.updateStory)(i,{title:T,content:A}),m(e=>e?{...e,title:T,content:A}:null),C(!1)}catch(e){console.error("Error updating story:",e),alert("Hikaye gÃ¼ncellenirken bir hata oluÅŸtu.")}finally{R(!1)}};return h?(0,t.jsx)("div",{className:"story-page",children:(0,t.jsx)("div",{className:"story-container",children:(0,t.jsxs)("div",{className:"loading-state",children:[(0,t.jsx)("div",{className:"spinner"}),(0,t.jsx)("p",{children:"Hikaye yÃ¼kleniyor..."})]})})}):d?(0,t.jsx)("div",{className:"story-page",children:(0,t.jsxs)("div",{className:"story-container",children:[(0,t.jsxs)(n.default,{href:"/",className:"back-button",children:[(0,t.jsx)("span",{children:"â†"}),"Ana Sayfaya DÃ¶n"]}),(0,t.jsxs)("article",{className:"story-article",children:[(0,t.jsxs)("header",{className:"story-header",children:[(0,t.jsxs)("div",{className:"story-meta",children:[(0,t.jsx)("span",{className:"category-badge",children:d.category}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,t.jsx)(j,{onSettingsChange:D,initialSettings:_}),(0,t.jsx)(f,{storyId:d.id,storyTitle:d.title,size:"small"}),(0,t.jsx)(y.default,{storyId:d.id}),(0,t.jsx)(c.default,{targetId:d.id,targetType:"story",targetContent:d.title,className:"opacity-50 hover:opacity-100"})]}),(0,t.jsx)("span",{className:"story-date",children:d.createdAt.toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric"})}),b&&b.uid===d.authorId&&(0,t.jsx)("div",{className:"author-actions",style:{marginLeft:"auto",display:"flex",gap:"8px"},children:S?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:L,disabled:E,className:"action-button save-button",style:{padding:"4px 12px",borderRadius:"4px",background:"#22c55e",color:"white",border:"none",cursor:E?"not-allowed":"pointer",fontSize:"0.9rem"},children:E?"Kaydediliyor...":"Kaydet"}),(0,t.jsx)("button",{onClick:()=>{C(!1),z(""),I("")},disabled:E,className:"action-button cancel-button",style:{padding:"4px 12px",borderRadius:"4px",background:"#6b7280",color:"white",border:"none",cursor:E?"not-allowed":"pointer",fontSize:"0.9rem"},children:"Ä°ptal"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>{d&&(z(d.title),I(d.content),C(!0))},className:"action-button edit-button",style:{padding:"4px 12px",borderRadius:"4px",background:"#3b82f6",color:"white",border:"none",cursor:"pointer",fontSize:"0.9rem"},children:"DÃ¼zenle"}),(0,t.jsx)("button",{onClick:$,disabled:w,className:"action-button delete-button",style:{padding:"4px 12px",borderRadius:"4px",background:"#ef4444",color:"white",border:"none",cursor:w?"not-allowed":"pointer",fontSize:"0.9rem"},children:w?"Siliniyor...":"Sil"})]})})]}),S?(0,t.jsx)("input",{type:"text",value:T,onChange:e=>z(e.target.value),className:"story-title-input",style:{width:"100%",fontSize:"2rem",fontWeight:"bold",marginBottom:"1rem",padding:"0.5rem",border:"1px solid #ccc",borderRadius:"4px",color:"black"}}):(0,t.jsx)("h1",{className:"story-title",children:d.title}),(0,t.jsxs)("div",{className:"author-section",children:[(0,t.jsxs)("div",{className:"author-info",children:[(0,t.jsx)("span",{className:"author-avatar",children:d.author.avatar}),(0,t.jsx)("span",{className:"author-name",children:d.author.name})]}),(0,t.jsxs)("div",{className:"story-stats",children:[(0,t.jsxs)("span",{className:"stat",children:[(0,t.jsx)("span",{className:"stat-icon",children:"ðŸ‘ï¸"}),B(d.stats.views)," gÃ¶rÃ¼ntÃ¼lenme"]}),(0,t.jsxs)("span",{className:"stat",children:[(0,t.jsx)("span",{className:"stat-icon",children:"ðŸ’¬"}),B(d.stats.comments)," yorum"]}),(0,t.jsxs)("span",{className:"stat",children:[(0,t.jsx)("span",{className:"stat-icon",children:"â¤ï¸"}),B(d.stats.likes)," beÄŸeni"]})]})]})]}),"interactive"===d.type&&d.nodes?(0,t.jsx)(N,{story:d,readingSettings:_,onProgressUpdate:e=>console.log("Path updated:",e)}):(0,t.jsx)("div",{className:"story-content",style:{fontFamily:"serif"===_.font?'ui-serif, Georgia, Cambria, "Times New Roman", Times, serif':"mono"===_.font?"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace":"ui-sans-serif, system-ui, sans-serif",fontSize:"small"===_.size?"0.95rem":"large"===_.size?"1.25rem":"xlarge"===_.size?"1.5rem":"1.1rem",lineHeight:"xlarge"===_.size?"2":"1.8",backgroundColor:"sepia"===_.theme?"#f4ecd8":"dark"===_.theme?"#1f2937":"transparent",color:"sepia"===_.theme?"#433422":"dark"===_.theme?"#e5e7eb":"inherit",padding:"light"!==_.theme?"3rem":"0",borderRadius:"light"!==_.theme?"4px":"0",transition:"all 0.3s ease",boxShadow:"sepia"===_.theme?"inset 20px 0 50px rgba(0,0,0,0.05), 5px 5px 15px rgba(0,0,0,0.1)":"none",borderLeft:"sepia"===_.theme?"2px solid rgba(0,0,0,0.05)":"none",backgroundImage:"sepia"===_.theme?"linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.2) 5%, rgba(255,255,255,0) 10%)":"none"},children:S?(0,t.jsx)("textarea",{value:A,onChange:e=>I(e.target.value),className:"story-content-textarea",style:{width:"100%",minHeight:"400px",fontSize:"inherit",lineHeight:"inherit",fontFamily:"inherit",padding:"1rem",border:"1px solid #ccc",borderRadius:"4px",color:"black",backgroundColor:"white"}}):d.content.split("\n\n").map((e,r)=>(0,t.jsx)("p",{style:{marginBottom:"1.5em"},children:e},r))})]}),(0,t.jsx)(x,{storyId:i,storyAuthorId:d.authorId,storyTitle:d.title,initialComments:p})]})}):((0,a.notFound)(),null)}e.s(["default",()=>w],44316)}]);