module.exports=[94936,(a,b,c)=>{var d=0/0,e=/^\s+|\s+$/g,f=/^[-+]0x[0-9a-f]+$/i,g=/^0b[01]+$/i,h=/^0o[0-7]+$/i,i=parseInt,j=a.g&&a.g.Object===Object&&a.g,k="object"==typeof self&&self&&self.Object===Object&&self,l=j||k||Function("return this")(),m=Object.prototype.toString,n=Math.max,o=Math.min,p=function(){return l.Date.now()};function q(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function r(a){if("number"==typeof a)return a;if("symbol"==typeof(b=a)||b&&"object"==typeof b&&"[object Symbol]"==m.call(b))return d;if(q(a)){var b,c="function"==typeof a.valueOf?a.valueOf():a;a=q(c)?c+"":c}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(e,"");var j=g.test(a);return j||h.test(a)?i(a.slice(2),j?2:8):f.test(a)?d:+a}b.exports=function(a,b,c){var d,e,f,g,h,i,j=0,k=!1,l=!1,m=!0;if("function"!=typeof a)throw TypeError("Expected a function");function s(b){var c=d,f=e;return d=e=void 0,j=b,g=a.apply(f,c)}function t(a){var c=a-i,d=a-j;return void 0===i||c>=b||c<0||l&&d>=f}function u(){var a,c,d,e=p();if(t(e))return v(e);h=setTimeout(u,(a=e-i,c=e-j,d=b-a,l?o(d,f-c):d))}function v(a){return(h=void 0,m&&d)?s(a):(d=e=void 0,g)}function w(){var a,c=p(),f=t(c);if(d=arguments,e=this,i=c,f){if(void 0===h)return j=a=i,h=setTimeout(u,b),k?s(a):g;if(l)return h=setTimeout(u,b),s(i)}return void 0===h&&(h=setTimeout(u,b)),g}return b=r(b)||0,q(c)&&(k=!!c.leading,f=(l="maxWait"in c)?n(r(c.maxWait)||0,b):f,m="trailing"in c?!!c.trailing:m),w.cancel=function(){void 0!==h&&clearTimeout(h),j=0,d=i=e=h=void 0},w.flush=function(){return void 0===h?g:v(p())},w}},4881,a=>{"use strict";a.i(69387);var b=a.i(60574),c=a.i(79353),d=a.i(94936);let e=(0,b.collection)(c.db,"drafts");async function f(a){try{let c={...a,lastSaved:(0,b.serverTimestamp)(),createdAt:(0,b.serverTimestamp)()},d=await (0,b.addDoc)(e,c);return{success:!0,draftId:d.id}}catch(a){return console.error("Error saving draft:",a),{success:!1,error:"Taslak kaydedilemedi"}}}async function g(a,d){try{let e=(0,b.doc)(c.db,"drafts",a);return await (0,b.updateDoc)(e,{...d,lastSaved:(0,b.serverTimestamp)()}),{success:!0}}catch(a){return console.error("Error updating draft:",a),{success:!1,error:"Taslak güncellenemedi"}}}let h=(0,d.default)(async(a,b)=>await g(a,b),2e3);async function i(a){try{let c=(0,b.query)(e,(0,b.where)("userId","==",a),(0,b.orderBy)("lastSaved","desc"));return(await (0,b.getDocs)(c)).docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date,lastSaved:b.lastSaved?.toDate()||new Date}})}catch(a){return console.error("Error fetching drafts:",a),[]}}async function j(a){try{let d=(0,b.doc)(c.db,"drafts",a),e=await (0,b.getDoc)(d);if(!e.exists())return null;let f=e.data();return{id:e.id,...f,createdAt:f.createdAt?.toDate()||new Date,lastSaved:f.lastSaved?.toDate()||new Date}}catch(a){return console.error("Error fetching draft:",a),null}}async function k(a){try{let d=(0,b.doc)(c.db,"drafts",a);return await (0,b.deleteDoc)(d),{success:!0}}catch(a){return console.error("Error deleting draft:",a),{success:!1,error:"Taslak silinemedi"}}}a.s(["autoSaveDraft",0,h,"deleteDraft",()=>k,"getDraftById",()=>j,"getDrafts",()=>i,"saveDraft",()=>f])},55185,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(11642),e=a.i(50944),f=a.i(4881);function g({initialDraft:a}){let{user:g}=(0,d.useAuth)(),h=(0,e.useRouter)(),[i,j]=(0,c.useState)(a?.title||""),[k,l]=(0,c.useState)(a?.content||""),[m,n]=(0,c.useState)(a?.category||""),[o,p]=(0,c.useState)(a?.excerpt||""),[q,r]=(0,c.useState)(a?.coverImage||""),[s,t]=(0,c.useState)(a?.id||null),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(a?.lastSaved?.toDate()||null),[y,z]=(0,c.useState)("saved");(0,c.useEffect)(()=>{if(!g||!i)return;let a=setTimeout(async()=>{z("saving");let a={userId:g.uid,title:i,content:k,category:m,excerpt:o,coverImage:q,autoSaveEnabled:!0};try{if(s)await (0,f.autoSaveDraft)(s,a),x(new Date),z("saved");else if(i.length>3){let b=await (0,f.saveDraft)(a);b.success&&b.draftId&&(t(b.draftId),x(new Date),z("saved"))}}catch(a){console.error("Auto-save error:",a),z("error")}},2e3);return()=>clearTimeout(a)},[i,k,m,o,q,g,s]);let A=async()=>{if(s&&g){v(!0);try{let a=await g.getIdToken(),b=await fetch("/api/create-story",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:i,content:k,excerpt:o,category:m,coverImage:q,idToken:a})}),c=await b.json();if(b.ok&&c.success)await (0,f.deleteDraft)(s),h.push(`/story/${c.storyId}`);else{let a=c.details?c.details.join("\n"):c.error||"Yayınlama başarısız";alert("Hata:\n"+a)}}catch(a){console.error("Publish error:",a),alert("Bir hata oluştu. Lütfen tekrar deneyin.")}finally{v(!1)}}};return(0,b.jsxs)("div",{className:"draft-editor",children:[(0,b.jsxs)("div",{className:"editor-header",children:[(0,b.jsxs)("div",{className:"save-status",children:["saving"===y&&"Kaydediliyor...","saved"===y&&w&&`Son kayıt: ${w.toLocaleTimeString()}`,"error"===y&&"Kayıt hatası!"]}),(0,b.jsx)("div",{className:"editor-actions",children:(0,b.jsx)("button",{className:"publish-button",onClick:A,disabled:u||!i||!k,children:u?"Yayınlanıyor...":"Yayınla"})})]}),(0,b.jsxs)("div",{className:"editor-form",children:[(0,b.jsx)("input",{type:"text",className:"editor-title",placeholder:"Hikaye Başlığı",value:i,onChange:a=>j(a.target.value)}),(0,b.jsxs)("select",{className:"editor-category",value:m,onChange:a=>n(a.target.value),children:[(0,b.jsx)("option",{value:"",children:"Kategori Seçin"}),(0,b.jsx)("option",{value:"Macera",children:"Macera"}),(0,b.jsx)("option",{value:"Bilim Kurgu",children:"Bilim Kurgu"}),(0,b.jsx)("option",{value:"Romantik",children:"Romantik"}),(0,b.jsx)("option",{value:"Korku",children:"Korku"}),(0,b.jsx)("option",{value:"Fantastik",children:"Fantastik"}),(0,b.jsx)("option",{value:"Dram",children:"Dram"}),(0,b.jsx)("option",{value:"Komedi",children:"Komedi"})]}),(0,b.jsx)("textarea",{className:"editor-excerpt",placeholder:"Kısa Açıklama (Özet)",value:o,onChange:a=>p(a.target.value),rows:3}),(0,b.jsx)("textarea",{className:"editor-content",placeholder:"Hikayenizi buraya yazın...",value:k,onChange:a=>l(a.target.value),rows:15})]})]})}function h(){let{user:a,loading:h}=(0,d.useAuth)(),i=(0,e.useRouter)(),j=(0,e.useSearchParams)().get("draftId"),[k,l]=(0,c.useState)(void 0),[m,n]=(0,c.useState)(!!j);return((0,c.useEffect)(()=>{h||a||i.push("/")},[a,h,i]),(0,c.useEffect)(()=>{j&&a&&b();async function b(){try{let b=await (0,f.getDraftById)(j);b&&b.userId===a?.uid?l(b):i.push("/create")}catch(a){console.error("Error loading draft:",a)}finally{n(!1)}}},[j,a,i]),h||m)?(0,b.jsx)("div",{className:"create-page",children:(0,b.jsx)("div",{className:"create-container",children:(0,b.jsxs)("div",{className:"loading-state",children:[(0,b.jsx)("div",{className:"spinner"}),(0,b.jsx)("p",{children:"Yükleniyor..."})]})})}):a?(0,b.jsx)("div",{className:"create-page",children:(0,b.jsxs)("div",{className:"create-container",children:[(0,b.jsxs)("div",{className:"create-header",children:[(0,b.jsxs)("h1",{className:"page-title",children:[(0,b.jsx)("span",{className:"title-icon",children:"✍️"}),k?"Taslağı Düzenle":"Yeni Hikaye Yaz"]}),(0,b.jsx)("p",{className:"page-subtitle",children:k?"Kaldığınız yerden devam edin...":"Hayal gücünüzü serbest bırakın ve hikayenizi dünyayla paylaşın"})]}),(0,b.jsx)(g,{initialDraft:k})]})}):null}function i(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"loading-state",children:(0,b.jsx)("div",{className:"spinner"})}),children:(0,b.jsx)(h,{})})}a.s(["default",()=>i],55185)},51031,a=>{a.v(b=>Promise.all(["server/chunks/ssr/src_lib_firestore_ts_70d184a6._.js"].map(b=>a.l(b))).then(()=>b(77929)))}];

//# sourceMappingURL=_070e7660._.js.map