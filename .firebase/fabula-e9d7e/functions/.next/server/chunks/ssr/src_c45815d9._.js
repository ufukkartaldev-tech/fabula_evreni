module.exports=[77929,a=>{"use strict";a.i(69387);var b=a.i(60574),c=a.i(79353);let d=(0,b.collection)(c.db,"stories"),e=(0,b.collection)(c.db,"comments");async function f(){console.warn("âš ï¸ getStories() is deprecated. Use getStoriesPaginated() for better performance.");try{let a=(0,b.query)(d,(0,b.orderBy)("createdAt","desc"));return(await (0,b.getDocs)(a)).docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}})}catch(a){return console.error("Error fetching stories:",a),[]}}async function g(a){try{let d=(0,b.doc)(c.db,"stories",a),e=await (0,b.getDoc)(d);if(!e.exists())return null;let f=e.data();return{id:e.id,...f,createdAt:f.createdAt?.toDate()||new Date}}catch(a){return console.error("Error fetching story:",a),null}}async function h(a){try{let c=(0,b.query)(e,(0,b.where)("storyId","==",a),(0,b.orderBy)("createdAt","desc")),d=(await (0,b.getDocs)(c)).docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}});return i(d)}catch(a){return console.error("Error fetching comments:",a),[]}}function i(a){let b=new Map,c=[];return a.forEach(a=>{b.set(a.id,{...a,replies:[]})}),a.forEach(a=>{let d=b.get(a.id);d&&c.push(d)}),c}async function j(a){try{return(await (0,b.addDoc)(e,{...a,createdAt:b.Timestamp.now()})).id}catch(a){throw console.error("Error adding comment:",a),a}}async function k(a){try{return(await (0,b.addDoc)(d,{...a,createdAt:b.Timestamp.now()})).id}catch(a){throw console.error("Error adding story:",a),a}}async function l(a){try{let d=(0,b.doc)(c.db,"stories",a);await (0,b.runTransaction)(c.db,async a=>{if(!(await a.get(d)).exists())throw Error("Story does not exist!");a.update(d,{"stats.views":(0,b.increment)(1)})})}catch(a){console.error("Error incrementing story views:",a)}}async function m(a,d){try{let e=(0,b.doc)(c.db,"stories",a);await (0,b.updateDoc)(e,{...d,updatedAt:b.Timestamp.now()})}catch(a){throw console.error("Error updating story:",a),a}}async function n(a){try{let d=(0,b.doc)(c.db,"stories",a);await (0,b.deleteDoc)(d)}catch(a){throw console.error("Error deleting story:",a),a}}function o(a,c){let e=c?(0,b.query)(d,(0,b.orderBy)("createdAt","desc"),(0,b.limit)(c)):(0,b.query)(d,(0,b.orderBy)("createdAt","desc"));return(0,b.onSnapshot)(e,b=>{a(b.docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}}))},a=>{console.error("Error in stories subscription:",a)})}function p(a,d){let e=(0,b.doc)(c.db,"stories",a);return(0,b.onSnapshot)(e,a=>{if(a.exists()){let b=a.data();d({id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date})}else d(null)},a=>{console.error("Error in story subscription:",a)})}function q(a,c){let d=(0,b.query)(e,(0,b.where)("storyId","==",a),(0,b.orderBy)("createdAt","desc"));return(0,b.onSnapshot)(d,a=>{c(i(a.docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}})))},a=>{console.error("Error in comments subscription:",a)})}async function r(a=12,c){try{let e=(0,b.query)(d,(0,b.orderBy)("createdAt","desc"),(0,b.limit)(a));c&&(e=(0,b.query)(d,(0,b.orderBy)("createdAt","desc"),(0,b.startAfter)(c),(0,b.limit)(a)));let f=await (0,b.getDocs)(e),g=f.docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}}).filter(a=>"DELETED"!==a.status),h=f.docs[f.docs.length-1]||null;return{stories:g,lastDoc:h}}catch(a){return console.error("Error fetching paginated stories:",a),{stories:[],lastDoc:null}}}a.s(["addComment",()=>j,"addStory",()=>k,"deleteStory",()=>n,"getCommentsByStoryId",()=>h,"getStories",()=>f,"getStoriesPaginated",()=>r,"getStoryById",()=>g,"incrementStoryViews",()=>l,"subscribeToComments",()=>q,"subscribeToStories",()=>o,"subscribeToStory",()=>p,"updateStory",()=>m])},94525,2088,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(11642);function e({isOpen:a,onClose:e,targetId:f,targetType:g,targetContent:h}){let{user:i}=(0,d.useAuth)(),[j,k]=(0,c.useState)("spam"),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(!1);if(!a)return null;let r=async a=>{if(a.preventDefault(),i){o(!0);try{let a=await i.getIdToken();(await fetch("/api/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetId:f,targetType:g,targetContent:h,reason:j,description:l,idToken:a})})).ok?(q(!0),setTimeout(()=>{e(),q(!1),m(""),k("spam")},2e3)):alert("Rapor gÃ¶nderilirken bir hata oluÅŸtu.")}catch(a){console.error("Report error:",a),alert("Bir hata oluÅŸtu.")}finally{o(!1)}}};return(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md overflow-hidden animate-scale-in",children:p?(0,b.jsxs)("div",{className:"p-8 text-center",children:[(0,b.jsx)("div",{className:"text-5xl mb-4",children:"âœ…"}),(0,b.jsx)("h3",{className:"text-xl font-bold text-gray-800 dark:text-white mb-2",children:"Rapor GÃ¶nderildi"}),(0,b.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Bildiriminiz iÃ§in teÅŸekkÃ¼rler. Ä°ncelenecektir."})]}):(0,b.jsxs)("form",{onSubmit:r,className:"p-6",children:[(0,b.jsx)("h3",{className:"text-xl font-bold text-gray-800 dark:text-white mb-4",children:"Ä°Ã§eriÄŸi Raporla"}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Sebep"}),(0,b.jsxs)("select",{value:j,onChange:a=>k(a.target.value),className:"w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,b.jsx)("option",{value:"spam",children:"Spam / Reklam"}),(0,b.jsx)("option",{value:"harassment",children:"Taciz / ZorbalÄ±k"}),(0,b.jsx)("option",{value:"inappropriate",children:"Uygunsuz Ä°Ã§erik"}),(0,b.jsx)("option",{value:"other",children:"DiÄŸer"})]})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"AÃ§Ä±klama (Opsiyonel)"}),(0,b.jsx)("textarea",{value:l,onChange:a=>m(a.target.value),className:"w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-24 resize-none",placeholder:"Daha fazla detay..."})]}),(0,b.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,b.jsx)("button",{type:"button",onClick:e,className:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Ä°ptal"}),(0,b.jsx)("button",{type:"submit",disabled:n,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:n?"GÃ¶nderiliyor...":"Raporla"})]})]})})})}function f({targetId:a,targetType:d,targetContent:f,className:g=""}){let[h,i]=(0,c.useState)(!1);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:()=>i(!0),className:`text-gray-400 hover:text-red-500 transition-colors ${g}`,title:"Raporla",children:"ðŸš©"}),(0,b.jsx)(e,{isOpen:h,onClose:()=>i(!1),targetId:a,targetType:d,targetContent:f})]})}function g({storyId:a,className:e=""}){let{user:f}=(0,d.useAuth)(),[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(!1),q=async()=>{if(f){l(!0);try{let a=await fetch(`/api/collections?userId=${f.uid}`),b=await a.json();b.collections&&j(b.collections)}catch(a){console.error("Error fetching collections:",a)}finally{l(!1)}}},r=async()=>{if(m.trim()&&f){p(!0);try{let a=await f.getIdToken();(await fetch("/api/collections",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:m,idToken:a})})).ok&&(n(""),q())}catch(a){console.error("Error creating collection:",a)}finally{p(!1)}}},s=async b=>{if(!f)return;let c=b.storyIds?.includes(a);try{let d=await f.getIdToken();(await fetch(`/api/collections/${b.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:c?"remove_story":"add_story",storyId:a,idToken:d})})).ok&&j(i.map(d=>{if(d.id===b.id){let b=c?d.storyIds.filter(b=>b!==a):[...d.storyIds||[],a];return{...d,storyIds:b}}return d}))}catch(a){console.error("Error updating collection:",a)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:()=>{f?(h(!0),q()):alert("LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n.")},className:`text-gray-400 hover:text-indigo-500 transition-colors ${e}`,title:"Listeye Ekle",children:"ðŸ”–"}),g&&(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md overflow-hidden animate-scale-in",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center",children:[(0,b.jsx)("h3",{className:"font-bold text-gray-800 dark:text-white",children:"Listeye Ekle"}),(0,b.jsx)("button",{onClick:()=>h(!1),className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),(0,b.jsx)("div",{className:"p-4 max-h-64 overflow-y-auto",children:k?(0,b.jsx)("div",{className:"text-center py-4",children:"YÃ¼kleniyor..."}):0===i.length?(0,b.jsx)("div",{className:"text-center py-4 text-gray-500",children:"HenÃ¼z listeniz yok."}):(0,b.jsx)("div",{className:"space-y-2",children:i.map(c=>{let d=c.storyIds?.includes(a);return(0,b.jsxs)("button",{onClick:()=>s(c),className:`w-full flex items-center justify-between p-3 rounded-lg border transition-all ${d?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[(0,b.jsx)("span",{className:"font-medium",children:c.name}),d&&(0,b.jsx)("span",{children:"âœ“"})]},c.id)})})}),(0,b.jsx)("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-100 dark:border-gray-700",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{type:"text",value:m,onChange:a=>n(a.target.value),placeholder:"Yeni liste adÄ±...",className:"flex-1 p-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm"}),(0,b.jsx)("button",{onClick:r,disabled:o||!m.trim(),className:"px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 text-sm font-medium",children:o?"...":"OluÅŸtur"})]})})]})})]})}a.s(["default",()=>f],94525),a.s(["default",()=>g],2088)}];

//# sourceMappingURL=src_c45815d9._.js.map