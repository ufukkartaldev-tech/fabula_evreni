module.exports=[77929,a=>{"use strict";a.i(69387);var b=a.i(60574),c=a.i(79353);let d=(0,b.collection)(c.db,"stories"),e=(0,b.collection)(c.db,"comments");async function f(){console.warn("⚠️ getStories() is deprecated. Use getStoriesPaginated() for better performance.");try{let a=(0,b.query)(d,(0,b.orderBy)("createdAt","desc"));return(await (0,b.getDocs)(a)).docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}})}catch(a){return console.error("Error fetching stories:",a),[]}}async function g(a){try{let d=(0,b.doc)(c.db,"stories",a),e=await (0,b.getDoc)(d);if(!e.exists())return null;let f=e.data();return{id:e.id,...f,createdAt:f.createdAt?.toDate()||new Date}}catch(a){return console.error("Error fetching story:",a),null}}async function h(a){try{let c=(0,b.query)(e,(0,b.where)("storyId","==",a),(0,b.orderBy)("createdAt","desc")),d=(await (0,b.getDocs)(c)).docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}});return i(d)}catch(a){return console.error("Error fetching comments:",a),[]}}function i(a){let b=new Map,c=[];return a.forEach(a=>{b.set(a.id,{...a,replies:[]})}),a.forEach(a=>{let d=b.get(a.id);d&&c.push(d)}),c}async function j(a){try{return(await (0,b.addDoc)(e,{...a,createdAt:b.Timestamp.now()})).id}catch(a){throw console.error("Error adding comment:",a),a}}async function k(a){try{return(await (0,b.addDoc)(d,{...a,createdAt:b.Timestamp.now()})).id}catch(a){throw console.error("Error adding story:",a),a}}async function l(a){try{let d=(0,b.doc)(c.db,"stories",a);await (0,b.runTransaction)(c.db,async a=>{if(!(await a.get(d)).exists())throw Error("Story does not exist!");a.update(d,{"stats.views":(0,b.increment)(1)})})}catch(a){console.error("Error incrementing story views:",a)}}async function m(a,d){try{let e=(0,b.doc)(c.db,"stories",a);await (0,b.updateDoc)(e,{...d,updatedAt:b.Timestamp.now()})}catch(a){throw console.error("Error updating story:",a),a}}async function n(a){try{let d=(0,b.doc)(c.db,"stories",a);await (0,b.deleteDoc)(d)}catch(a){throw console.error("Error deleting story:",a),a}}function o(a,c){let e=c?(0,b.query)(d,(0,b.orderBy)("createdAt","desc"),(0,b.limit)(c)):(0,b.query)(d,(0,b.orderBy)("createdAt","desc"));return(0,b.onSnapshot)(e,b=>{a(b.docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}}))},a=>{console.error("Error in stories subscription:",a)})}function p(a,d){let e=(0,b.doc)(c.db,"stories",a);return(0,b.onSnapshot)(e,a=>{if(a.exists()){let b=a.data();d({id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date})}else d(null)},a=>{console.error("Error in story subscription:",a)})}function q(a,c){let d=(0,b.query)(e,(0,b.where)("storyId","==",a),(0,b.orderBy)("createdAt","desc"));return(0,b.onSnapshot)(d,a=>{c(i(a.docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}})))},a=>{console.error("Error in comments subscription:",a)})}async function r(a=12,c){try{let e=(0,b.query)(d,(0,b.orderBy)("createdAt","desc"),(0,b.limit)(a));c&&(e=(0,b.query)(d,(0,b.orderBy)("createdAt","desc"),(0,b.startAfter)(c),(0,b.limit)(a)));let f=await (0,b.getDocs)(e),g=f.docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}}).filter(a=>"DELETED"!==a.status),h=f.docs[f.docs.length-1]||null;return{stories:g,lastDoc:h}}catch(a){return console.error("Error fetching paginated stories:",a),{stories:[],lastDoc:null}}}a.s(["addComment",()=>j,"addStory",()=>k,"deleteStory",()=>n,"getCommentsByStoryId",()=>h,"getStories",()=>f,"getStoriesPaginated",()=>r,"getStoryById",()=>g,"incrementStoryViews",()=>l,"subscribeToComments",()=>q,"subscribeToStories",()=>o,"subscribeToStory",()=>p,"updateStory",()=>m])}];

//# sourceMappingURL=src_lib_firestore_ts_70d184a6._.js.map