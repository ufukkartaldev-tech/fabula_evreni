{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/90538/Desktop/fabula/benim-hikaye-uygulamasi/src/lib/firebaseAdmin.ts"],"sourcesContent":["import 'server-only';\r\nimport * as admin from 'firebase-admin';\r\n\r\nif (!admin.apps.length) {\r\n    try {\r\n        admin.initializeApp({\r\n            credential: admin.credential.applicationDefault(),\r\n        });\r\n        console.log('Firebase Admin initialized with default credentials');\r\n    } catch (error) {\r\n        console.warn('Firebase Admin initialization failed. Make sure GOOGLE_APPLICATION_CREDENTIALS is set or you are running in a supported environment.', error);\r\n    }\r\n}\r\n\r\nexport const adminDb = admin.firestore();\r\nexport const adminAuth = admin.auth();\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,IAAI,CAAC,mIAAU,CAAC,MAAM,EAAE;IACpB,IAAI;QACA,4IAAmB,CAAC;YAChB,YAAY,yIAAgB,CAAC,kBAAkB;QACnD;QACA,QAAQ,GAAG,CAAC;IAChB,EAAE,OAAO,OAAO;QACZ,QAAQ,IAAI,CAAC,wIAAwI;IACzJ;AACJ;AAEO,MAAM,UAAU,wIAAe;AAC/B,MAAM,YAAY,mIAAU"}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/90538/Desktop/fabula/benim-hikaye-uygulamasi/src/app/api/get-top-stories/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { adminDb } from '@/lib/firebaseAdmin';\r\nimport { FieldValue } from 'firebase-admin/firestore';\r\n\r\n// Cache duration in milliseconds (e.g., 1 hour)\r\nconst CACHE_DURATION = 60 * 60 * 1000;\r\n\r\nexport async function GET() {\r\n    try {\r\n        const cacheRef = adminDb.collection('cache').doc('top_stories');\r\n        const cacheDoc = await cacheRef.get();\r\n        const now = Date.now();\r\n\r\n        let cachedData = cacheDoc.exists ? cacheDoc.data() : null;\r\n\r\n        // Check if cache is valid\r\n        if (cachedData && cachedData.updatedAt) {\r\n            const lastUpdate = cachedData.updatedAt.toMillis();\r\n            if (now - lastUpdate < CACHE_DURATION) {\r\n                return NextResponse.json({\r\n                    success: true,\r\n                    stories: cachedData.stories,\r\n                    source: 'cache'\r\n                });\r\n            }\r\n        }\r\n\r\n        // Cache is expired or missing, regenerate it\r\n        console.log('Regenerating top stories cache...');\r\n\r\n        const storiesSnapshot = await adminDb.collection('stories')\r\n            .orderBy('stats.views', 'desc')\r\n            .limit(10)\r\n            .get();\r\n\r\n        const stories = storiesSnapshot.docs.map(doc => {\r\n            const data = doc.data();\r\n            // Convert timestamps to ISO strings for JSON serialization\r\n            return {\r\n                id: doc.id,\r\n                ...data,\r\n                createdAt: data.createdAt?.toDate().toISOString(),\r\n                updatedAt: data.updatedAt?.toDate().toISOString(),\r\n                // Ensure stats exist\r\n                stats: {\r\n                    views: data.stats?.views || 0,\r\n                    likes: data.stats?.likes || 0,\r\n                    comments: data.stats?.comments || 0\r\n                }\r\n            };\r\n        });\r\n\r\n        // Save to cache\r\n        await cacheRef.set({\r\n            stories,\r\n            updatedAt: FieldValue.serverTimestamp()\r\n        });\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            stories,\r\n            source: 'database'\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Error fetching top stories:', error);\r\n        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,gDAAgD;AAChD,MAAM,iBAAiB,KAAK,KAAK;AAE1B,eAAe;IAClB,IAAI;QACA,MAAM,WAAW,wIAAO,CAAC,UAAU,CAAC,SAAS,GAAG,CAAC;QACjD,MAAM,WAAW,MAAM,SAAS,GAAG;QACnC,MAAM,MAAM,KAAK,GAAG;QAEpB,IAAI,aAAa,SAAS,MAAM,GAAG,SAAS,IAAI,KAAK;QAErD,0BAA0B;QAC1B,IAAI,cAAc,WAAW,SAAS,EAAE;YACpC,MAAM,aAAa,WAAW,SAAS,CAAC,QAAQ;YAChD,IAAI,MAAM,aAAa,gBAAgB;gBACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;oBACrB,SAAS;oBACT,SAAS,WAAW,OAAO;oBAC3B,QAAQ;gBACZ;YACJ;QACJ;QAEA,6CAA6C;QAC7C,QAAQ,GAAG,CAAC;QAEZ,MAAM,kBAAkB,MAAM,wIAAO,CAAC,UAAU,CAAC,WAC5C,OAAO,CAAC,eAAe,QACvB,KAAK,CAAC,IACN,GAAG;QAER,MAAM,UAAU,gBAAgB,IAAI,CAAC,GAAG,CAAC,CAAA;YACrC,MAAM,OAAO,IAAI,IAAI;YACrB,2DAA2D;YAC3D,OAAO;gBACH,IAAI,IAAI,EAAE;gBACV,GAAG,IAAI;gBACP,WAAW,KAAK,SAAS,EAAE,SAAS;gBACpC,WAAW,KAAK,SAAS,EAAE,SAAS;gBACpC,qBAAqB;gBACrB,OAAO;oBACH,OAAO,KAAK,KAAK,EAAE,SAAS;oBAC5B,OAAO,KAAK,KAAK,EAAE,SAAS;oBAC5B,UAAU,KAAK,KAAK,EAAE,YAAY;gBACtC;YACJ;QACJ;QAEA,gBAAgB;QAChB,MAAM,SAAS,GAAG,CAAC;YACf;YACA,WAAW,0KAAU,CAAC,eAAe;QACzC;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT;YACA,QAAQ;QACZ;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACJ"}}]
}